{% extends "base.html" %}
{% block title %}Mafia by. Xienxz326{% endblock %}
{% block content %}

  <!-- –§–û–ù: –∑–≤—ë–∑–¥—ã, –ª—É–Ω–∞, –æ–∑–µ—Ä–æ -->
  <div id="bg" class="bg">
    <div class="bg-sky"></div>
    <div class="bg-stars"></div>
    <div class="bg-moon"></div>
    <div class="bg-sun"></div>
    <div class="bg-lake"></div>
  </div>

  <div id="controls" class="controls">
    <select id="role" style="
    width: 100px;
    align-items: center;
    text-align: center;
    height: 30px;
    background: var(--card);
    color: #4296ff;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;">

      <option value="player" selected>–ò–≥—Ä–æ–∫</option>
      <option value="host">–í–µ–¥—É—â–∏–π</option>
    </select>
    <button id="joinBtn" {% if not current_user.is_authenticated %}disabled{% endif %}>–í–æ–π—Ç–∏</button>
    <button id="leaveBtn" disabled>–í—ã–π—Ç–∏</button>
    <button id="muteVideo" disabled>üì∑ –í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>

    <!-- —Ç–æ–ª—å–∫–æ –≤–µ–¥—É—â–µ–º—É: -->
    <button id="togglePhase" style="display:none">üåó –ù–æ—á—å</button>

    <!-- –ö–ù–û–ü–ö–ò –¢–ê–ô–ú–ï–†–ê ‚Äî –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–µ–¥—É—â–µ–º—É -->
    <div id="hostTimerControls" style="display:none; gap:6px; margin-left:8px; display:inline-flex;">
      <button id="start60">‚è±Ô∏è 1:00</button>
      <button id="start30">‚è±Ô∏è 0:30</button>
    </div>

    <div id="hostAnnounce" style="display:none; gap:6px; margin-left:8px; display:inline-flex; align-items:center;">
      <label style="opacity:.7">–¶–µ–ª—å:</label>
      <select id="announceTarget"></select>
      <button id="btnKilledDoc">üíâ –£–±–∏—Ç –î–æ–∫—Ç–æ—Ä</button>
      <button id="btnKilledCop">üïµÔ∏è –£–±–∏—Ç –ö–æ–º–∏—Å—Å–∞—Ä</button>
      <button id="btnKilledTown">üôã –£–±–∏—Ç –ú–∏—Ä–Ω—ã–π</button>
      <button id="btnExpelMafia">üî• –í—ã–≥–Ω–∞–ª–∏ –ú–∞—Ñ–∏—é</button>
    </div>

    <div id="globalAnnounce" class="global-annc" aria-hidden="true"></div>

    <!-- –î–ò–°–ü–õ–ï–ô –¢–ê–ô–ú–ï–†–ê ‚Äî –≤–∏–¥–µ–Ω –≤—Å–µ–º -->
    <span id="timerDisplay" class="timer">00:00</span>

    <span id="status"></span>


    <div id="hostVoting" style="display:none; gap:6px; margin-left:8px; align-items:center;">
      <button id="startVoting">üó≥Ô∏è –ù–∞—á–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</button>
      <button id="stopVoting"  style="display:none;">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>

      <span class="sep"></span>

      <label style="opacity:.7">–ö—Ç–æ:</label>
      <select id="voteVoter"></select>
      <label style="opacity:.7">–ü—Ä–æ—Ç–∏–≤:</label>
      <select id="voteTarget"></select>
      <button id="voteAdd">‚ûï –ó–∞—á–µ—Å—Ç—å</button>
      <button id="voteRemove">‚ûñ –û—Ç–º–µ–Ω–∏—Ç—å</button>
      <button id="votesClear">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>

    <div id="hostFX" style="display:none; gap:6px; margin-left:8px; display:inline-flex;">
      <button id="fxRed">üî¥ –ö—Ä–∞—Å–Ω—ã–π —Å–∏–≥–Ω–∞–ª</button>
      <button id="fxGreen">üü¢ –ó–µ–ª—ë–Ω—ã–π —Å–∏–≥–Ω–∞–ª</button>
    </div>




    <div id="hostFinalControls" style="display:none; gap:6px; margin-left:8px; display:inline-flex;">
      <button id="btnTownWin">üèÜ –ü–æ–±–µ–¥–∞ –ú–∏—Ä–Ω—ã—Ö</button>
      <button id="btnMafiaWin">üíÄ –ü–æ–±–µ–¥–∞ –ú–∞—Ñ–∏–∏</button>
    </div>

    <div id="hostSoundboard" style="display:none; gap:6px; margin-left:8px; display:inline-flex;">
      <button id="btnSfxGun">üî´ –í—ã—Å—Ç—Ä–µ–ª</button>
      <button id="btnSfxPulse">üíì –ü—É–ª—å—Å</button>
    </div>






    <!-- ‚ñ∫ SFX: –∑–≤—É–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–ª–æ–∂–∏ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã –≤ /static/sfx/ –∏ /static/music/) -->
    <div id="sfx" aria-hidden="true" style="height:0; overflow:hidden">
      <audio id="sfxKill"   src="/static/sfx/–≤—ã—Å—Ç—Ä–µ–ª_–ø–∏—Å—Ç–æ–ª–µ—Ç.mp3"   preload="auto"></audio>
      <audio id="sfxHeal"   src="/static/sfx/–ø—É–ª—å—Å-–¥–æ–∫—Ç–æ—Ä.mp3"   preload="auto"></audio>
      <audio id="sfxCheck"  src="/static/sfx/—â–µ–ª—á–æ–∫-–∫–æ–º–∏—Å–∞—Ä.mp3"  preload="auto"></audio>
    </div>

    <!-- ‚ñ∫ –§–ò–ù–ê–õ–¨–ù–´–ô –û–í–ï–†–õ–ï–ô -->
    <div id="finalOverlay" class="final-overlay" style="display:none">
      <div class="final-rays"></div>
      <div class="final-card">
        <div class="final-title" id="finalTitle"></div>
        <div class="final-sub"   id="finalSub"></div>
      </div>
    </div>

  </div>

  {% if not current_user.is_authenticated %}
    <p class="muted">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ.</p>
  {% endif %}

  <div id="grid" class="grid">
    <script>
      for (let i=1;i<=12;i++){
        document.write(`
         <div class="cell" data-slot="${i}">
          <span style="margin-left: 10px;" class="slot-num" id="num-${i}">${i}</span>
          <div class="cell-header"><span class="name" id="name-${i}">–°–≤–æ–±–æ–¥–Ω–æ</span></div>
          <div class="badge" id="badge-${i}"></div>

          <div class="curtain">
            <video class="fx-video" playsinline muted></video>
            <span class="curtain-text"></span>
          </div>

          <video id="video-${i}" autoplay playsinline muted></video>
        </div>
        `);
      }
    </script>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    const DEFAULT_ROOM = "mafia";
    const CURRENT_USERNAME = "{{ current_user.username if current_user.is_authenticated else '' }}";
  </script>
  <script src="{{ url_for('static', filename='client.js') }}"></script>
{% endblock %}
